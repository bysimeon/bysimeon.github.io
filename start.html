<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>launch</title>
  <link rel="stylesheet" href="style_start.css">
  <link href="assets/favicon.png" rel="shortcut icon" type="image/x-icon"/>
</head>
<body>
  <div id="back">
    <a href="./">back</a>
  </div>
  <div id="songb">
    <a id="song" href="#" target="_blank"></a>
  </div>
  <div id="searchlink">
    <a onclick="opensearchbox()">search</a>
  </div>
  <div id="help">
    <a onclick="commands()">help</a>
  </div>
  <div id="command">
    <div id="close1">
      <a onclick="closeall()"> close </a>
    </div>
    <div id="command-list">
      press <span> space </span> to open searchbox, <span> google </span> is used by default. enter a <span> url </span> to open that webpage.
      search specific sites by using one of the following shortcuts before your query:
      <ul>
        <li> reddit (r:)</li>
        <li> subreddits (r/examplesubreddit goes to examplesubreddit) </li>
        <li> youtube (y:) </li>
        <li> soundcloud (s:) </li>
        <li> twitch (t:) [game names] </li>
        <li> myanimelist (a:)</li>
      </ul>
      press <span> esc </span> to close searchbox and this help page. <br> <br>
      p.s. the song displayed at the bottom right is my most recent track from last.fm
    </div>
  </div>
  <div id="search">
    <div id="close2">
      <a onclick="closeall()"> close </a>
    </div>
    <input id="search-field" type="text" name="search-field" onkeyup="return search(event)"/>
  </div>
  <div class="container">
    <div id="clock"></div>
    <div id="date"> 4 / 14 / 2018 </div>
    <div class="weather-container">
      <div class="row">
        <div id="weather-description"class="inline"></div>
        <div class="inline">-</div>
        <div id="temp" class="inline"></div>
      </div>
    </div>
    <div class="bookmark-container">
      <div class="bookmark-set">
        <div class="bookmark-title">tools</div>
        <div class="bookmark-inner-container">
          <a class="bookmark" href="https://keep.google.com/" target="_blank">keep</a>
          <a class="bookmark" href="https://inbox.google.com/" target="_blank">inbox</a>
          <a class="bookmark" href="https://github.com/" target="_blank">github</a>
          <a class="bookmark" href="https://drive.google.com/" target="_blank">drive</a>
          <a class="bookmark" href="https://calendar.google.com/" target="_blank">calendar</a>
        </div>
      </div>
      <div class="bookmark-set">
        <div class="bookmark-title">media</div>
        <div class="bookmark-inner-container">
          <a class="bookmark" href="https://netflix.com" target="_blank">netflix</a>
          <a class="bookmark" href="https://youtube.com" target="_blank">youtube</a>
          <a class="bookmark" href="https://twitch.tv" target="_blank">twitch</a>
          <a class="bookmark" href="https://last.fm" target="_blank">last.fm</a>
          <a class="bookmark" href="http://horriblesubs.info" target="_blank">badsubs</a>
          <a class="bookmark" href="https://myanimelist.net" target="_blank">myanimelist</a>
        </div>
      </div>
      <div class="bookmark-set">
        <div class="bookmark-title">reddit</div>
        <div class="bookmark-inner-container">
          <a class="bookmark" href="https://reddit.com/r/programming" target="_blank">/r/programming</a>
          <a class="bookmark" href="https://reddit.com/r/fixedgearbicycle" target="_blank">/r/fixedgears</a>
          <a class="bookmark" href="https://reddit.com/r/unixporn" target="_blank">/r/mechkeyboards</a>
          <a class="bookmark" href="https://reddit.com/r/hiphopheads" target="_blank">/r/hiphopheads</a>
          <a class="bookmark" href="https://reddit.com/r/minimalism" target="_blank">/r/minimalism</a>
          <a class="bookmark" href="https://reddit.com/r/startpages" target="_blank">/r/startpages</a>
        </div>
      </div>
      <div class="bookmark-set">
        <div class="bookmark-title">chat</div>
        <div class="bookmark-inner-container">
          <a class="bookmark" href="https://hangouts.google.com/" target="_blank">hangouts</a>
          <a class="bookmark" href="https://allo.google.com/web" target="_blank">allo</a>
          <a class="bookmark" href="https://groupme.com" target="_blank">groupme</a>
          <a class="bookmark" href="https://slack.com" target="_blank">slack</a>
        </div>
      </div>
      <div class="bookmark-set">
        <div class="bookmark-title">school</div>
        <div class="bookmark-inner-container">
          <a class="bookmark" href="https://canvas.northwestern.edu" target="_blank">canvas</a>
          <a class="bookmark" href="https://caesar.northwestern.edu" target="_blank">caesar</a>
          <a class="bookmark" href="https://myhr.northwestern.edu" target="_blank">myhr</a>
        </div>
      </div>
    </div>
  </div>

  <script>
  soundcloud = false;
  youtube = false;
  twitch = false;
  myanimelist = false;
  reddit = false;
  redditlink = false;
  gdrive = false;
  lastfm = false;
  github = false;

  function clear() {
    document.getElementById("search-field").style.background = "#000"
    soundcloud = false;
    youtube = false;
    twitch = false;
    myanimelist = false;
    reddit = false;
    redditlink = false;
    gdrive = false;
    lastfm = false;
    github = false;
  }

  function cutoff(num, str) {
    if (str.substring(0,1) != " ") {
      num2 = num - 1;
      return num2;
    }
    num2 = num;
    return num2
  }

  function search(e) {
    var val = document.getElementById("search-field").value;

    if (val.length <= cutoff(3, val)) {
      if (val.endsWith('s:') || val.endsWith('S:')) {
        if (! val.endsWith('tps:')) {
          console.log("soundcloud");
          clear();
          soundcloud = true;
          document.getElementById("search-field").style.background = "-webkit-linear-gradient(to right, #fe8c00, #f83600)";
          document.getElementById("search-field").style.background = "linear-gradient(to right, #fe8c00, #f83600)";
        }
      }
      if (val.endsWith('y:') || val.endsWith('Y:')) {
        console.log("youtube");
        clear();
        youtube = true;
        document.getElementById("search-field").style.background = "-webkit-linear-gradient(to right, #e52d27, #b31217)";
        document.getElementById("search-field").style.background = "linear-gradient(to right, #e52d27, #b31217)";
      }
      if (val.endsWith('t:') || val.endsWith('T:')) {
        console.log("twitch");
        clear();
        twitch = true;
        document.getElementById("search-field").style.background = "-webkit-linear-gradient(to right, #6441a5, #2a0845)";
        document.getElementById("search-field").style.background = "linear-gradient(to right, #6441a5, #2a0845)";
      }
      if (val.endsWith('a:') || val.endsWith('A:')) {
        console.log("myanimelist");
        clear();
        myanimelist = true;
        document.getElementById("search-field").style.background = "-webkit-linear-gradient(to right, #1488cc, #2e51a2)";
        document.getElementById("search-field").style.background = "linear-gradient(to right, #1488cc, #2e51a2)";
      }
      if (val.endsWith('r:') || val.endsWith('R:')) {
        console.log("reddit");
        clear();
        reddit = true;
        document.getElementById("search-field").style.background = "-webkit-linear-gradient(to right, #5f99cf, #cee3f8)";
        document.getElementById("search-field").style.background = "linear-gradient(to right, #5f99cf, #cee3f8)";
      }
      if (val.endsWith('r/') || val.endsWith('R/')) {
        console.log("redditlink");
        clear();
        redditlink = true;
        document.getElementById("search-field").style.background = "-webkit-linear-gradient(to right, #5f99cf, #cee3f8)";
        document.getElementById("search-field").style.background = "linear-gradient(to right, #5f99cf, #cee3f8)";
      }
      if (val.endsWith('d:') || val.endsWith('D:')) {
        console.log("google drive");
        clear();
        gdrive = true;
        document.getElementById("search-field").style.background = "-webkit-linear-gradient(to right, #4285f4, #fbbc05)";
        document.getElementById("search-field").style.background = "linear-gradient(to right, #4285f4, #fbbc05)";
      }
      if (val.endsWith('l:') || val.endsWith('L:')) {
        console.log("lastfm");
        clear();
        lastfm = true;
        document.getElementById("search-field").style.background = "-webkit-linear-gradient(to right, #d51007, #d32d27)";
        document.getElementById("search-field").style.background = "linear-gradient(to right, #d51007, #d32d27)";
      }
      if (val.endsWith('g:') || val.endsWith('G:')) {
        console.log("github");
        clear();
        github = true;
        document.getElementById("search-field").style.background = "-webkit-linear-gradient(to right, #767676, #999)";
        document.getElementById("search-field").style.background = "linear-gradient(to right, #767676, #999)";
      }
    }

    if (! val.includes(":") && ! val.includes("/")) {
      if (soundcloud || twitch || youtube || reddit || myanimelist || redditlink || gdrive || lastfm || github) {

      }
      clear();
    }

    if (e.keyCode == 13) {
      if (soundcloud) {
        window.open("https://soundcloud.com/search?q=" + val.substr(cutoff(3, val)).trim());
        clear();
      }
      else if (youtube) {
        window.open("https://www.youtube.com/results?search_query=" + val.substr(cutoff(3, val)).trim());
        clear();
      }
      else if (twitch) {
        window.open("https://www.twitch.tv/directory/game/" + val.substr(cutoff(3, val)).trim());
        clear();
      }
      else if (myanimelist) {
        window.open("https://myanimelist.net/search/all?q=" + val.substr(cutoff(3, val)).trim());
        clear();
      }
      else if (reddit) {
        window.open("https://www.reddit.com/search?q=" + val.substr(cutoff(3, val)).trim());
        clear();
      }
      else if (redditlink) {
        window.open("https://www.reddit.com/r/" + val.substr(cutoff(3, val)).trim());
        clear();
      }
      else if (gdrive) {
        window.open("https://drive.google.com/drive/u/0/search?q=" + val.substr(cutoff(3, val)).trim());
        clear();
      }
      else if (lastfm) {
        window.open("https://www.last.fm/search?q=" + val.substr(cutoff(3, val)).trim());
        clear();
      }
      else if (github) {
        window.open("https://github.com/search?utf8=%E2%9C%93&q=" + val.substr(cutoff(3, val)).trim());
        clear();
      }
      else if (val.includes('.com') || val.includes('.net') || val.includes('.co') ||
      val.includes('.io') || val.includes('.xyz') || val.includes('.gov') || val.includes('.org') || val.includes('.se') ||
      val.includes('.fm') || val.includes('.de') || val.includes('.uk') || val.includes('.gg') || val.includes('.info') ||
      val.includes('.ai') || val.includes('.ch') || val.includes('.edu')) {
        if (val.includes('http')) {
          window.open(val.trim());
        } else {
          window.open("http://" + val.trim());
        }
      }
      else {
       window.open("https://google.com/search?q=" + val.trim());
      }
      document.getElementById('search-field').value = '';
      document.getElementById('search-field').blur();
      document.getElementById('search').style.display = 'none';
    }
  }

  const monthNames = ["january", "february", "march", "april", "may", "june",
  "july", "august", "september", "october", "november", "december" ];

  const dayNames = ["", "first", "second", "third", "fourth", "fifth", "sixth",
  "seventh", "eighth", "ninth", "tenth", "eleventh", "twelfth", "thirteenth", "fourteenth",
  "fiftheenth", "sixteenth", "seventeenth", "eighteenth", "nineteenth", "twentyith", "twentyfirst",
  "wentysecond", "twentythird", "twentyfourth", "twentyfifth", "twentysixth", "twenyseventh", "twentyeight",
  "twentyninth", "thirtyith", "thirtyfirst"];

  function getTime() {
    let date = new Date(),
    min = date.getMinutes(),
    sec = date.getSeconds(),
    hour = date.getHours();

    return "" +
    (hour < 10 ? ("0" + hour) : hour) + ":" +
    (min < 10 ? ("0" + min) : min) + ":" +
    (sec < 10 ? ("0" + sec) : sec);
  }

  function getDay() {
    let date = new Date(),
    day = dayNames[date.getDate()];
    month = monthNames[date.getMonth()];

    return "" + month + " " + day;
  }

  apikey = "a7f8dd0989ae6f42d1be2c4427767c6f";
  apibase = "https://ws.audioscrobbler.com/2.0/";
  user = "theblindlookout";

  window.onload = () => {
    function theweather() {
      let xhr = new XMLHttpRequest();
      xhr.open('GET', 'https://cors-anywhere.herokuapp.com/http://api.openweathermap.org/data/2.5/weather?zip=60201,us&units=Imperial&appid=4119dfca25e96bf1f10f35a975835f6c');
      xhr.onload = () => {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            let json = JSON.parse(xhr.responseText);
            console.log(json);
            document.getElementById("temp").innerHTML = json.main.temp.toFixed(0) + "&#176 f";
            document.getElementById("weather-description").innerHTML = json.weather[0].description;
          } else {
            console.log('error msg: ' + xhr.status);
          }
        }
      }
      xhr.send();
    }

    function recenttrack() {
      let xhr2 = new XMLHttpRequest();
      xhr2.open('GET', apibase + "?method=user.getrecenttracks&user=" + user +  "&api_key=" + apikey + "&format=json");
      xhr2.onload = () => {
        if (xhr2.readyState === 4) {
          if (xhr2.status === 200) {
            let json2 = JSON.parse(xhr2.responseText);
            console.log(json2);
            document.getElementById('song').innerHTML = json2.recenttracks.track[0].name + " - " + json2.recenttracks.track[0].artist['#text'];
            document.getElementById('song').setAttribute("href", json2.recenttracks.track[0].url);
          } else {
            console.log('error msg: ' + xhr.status);
          }
        }
      }
      xhr2.send();
    }

    recenttrack();
    setInterval(recenttrack, 500);

    theweather();
    setInterval(theweather, 6000000);

    document.getElementById("clock").innerHTML = getTime();
    document.getElementById("date").innerHTML = getDay();

    setInterval( () => {
      document.getElementById("clock").innerHTML = getTime();
      document.getElementById("date").innerHTML = getDay();
    },100);
  }

  document.addEventListener("keydown", event => {
    if (event.keyCode == 32) {          // Spacebar code to open search
      document.getElementById('search').style.display = 'flex';
      document.getElementById('search-field').focus();
    } else if (event.keyCode == 27) {   // Esc to close search
      document.getElementById('search-field').value = '';
      document.getElementById('search-field').blur();
      document.getElementById('search').style.display = 'none';
      document.getElementById('command').style.display = 'none';
      document.getElementById('command-list').blur();
      clear();
    }
  });

  function commands() {
    document.getElementById('command').style.display = 'flex';
    document.getElementById('command-list').focus();
  }

  function opensearchbox() {
    document.getElementById('search').style.display = 'flex';
    document.getElementById('search-field').focus();
  }

  function closeall() {
    document.getElementById('search-field').value = '';
    document.getElementById('search-field').blur();
    document.getElementById('search').style.display = 'none';
    document.getElementById('command').style.display = 'none';
    document.getElementById('command-list').blur();
    clear();
  }

  </script>
</body>
</html>
